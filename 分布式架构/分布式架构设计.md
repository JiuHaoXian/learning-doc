# 如何设计一个幂等接口

客户端拦截：隐藏按钮

数据库：

* 乐观锁：版本号where +1 or =0
* 悲观锁：~~每次通过查询数据库确认数据~~
* 唯一索引，防止重复插入

JVM实现幂等性：

* jvm锁实现是指通过JVM提供的内置锁，如Lock或者是synchronize来实现幂等性

分布式锁：

* redis：setnx + 过期时间



##### 架构一个好的系统框架,需要哪些因素?

**编程模型的复杂度：**

**整个系统的性能：**

**可扩展性**

生命周期、效率，其优势和瓶颈

高可用、高可靠、可伸缩、高性能



##### 接口的设计注意什么？

可扩展：接口颗粒度、文档，接口请求类型、接口名、版本号、接口文档、统一返回参数规则、统一错误码、考虑数据是否需要分页、统一时间格式

安全性：是否需要白名单。访问权限，非法参数控制，时间戳超时机制、是否需要服务治理。

性能：TPS、并发数、响应时长。数据存储。DB选型、缓存选型。是否需要依赖于第三方。是否需要缓存接口、防刷。接口限流、降级。负载均衡器支持。

